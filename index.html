<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Venta +</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; background: #f4f7f6; display: flex; align-items: center; justify-content: center; height: 100vh; }
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; transition: opacity 0.5s; }
        .logo { font-size: 3rem; font-weight: bold; color: #1a1a1a; }
        .logo span { color: #0052ff; }
        .login-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 350px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; background: #0052ff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        button:hover { background: #0041cc; }
        p { color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="splash">
        <div class="logo">Mi Venta <span>+</span></div>
        <p>Más control, más resultados</p>
    </div>

    <div class="login-card">
        <h2>Ingresar</h2>
        <p>Introduce tu email para recibir un enlace de acceso mágico.</p>
        <input type="email" id="email" placeholder="tu@email.com" required>
        <button onclick="enviarCodigo()">Recibir Enlace</button>
    </div>

    <script>
        // Configuração do seu Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDBntAU1uA5zGGZRW3c0Olxn_fe7-D0EFM",
            authDomain: "miguarani.firebaseapp.com",
            projectId: "miguarani",
            storageBucket: "miguarani.firebasestorage.app",
            messagingSenderId: "526507667874",
            appId: "1:526507667874:web:b5b08c890c832d5f2702fb",
            measurementId: "G-3R3PNJ3GM4"
        };
        
        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);

        // Configurações do link de e-mail
        const actionCodeSettings = {
          url: 'https://mi-venta-plus.vercel.app', // Link de retorno após clicar no e-mail
          handleCodeInApp: true,
        };

        // Efeito da Splash Screen
        setTimeout(() => {
            const splash = document.getElementById('splash');
            splash.style.opacity = '0';
            setTimeout(() => { splash.style.display = 'none'; }, 500);
        }, 2500);

        // Função para enviar o link real de login
        function enviarCodigo() {
            const email = document.getElementById('email').value;
            
            if(!email || !email.includes('@')) {
                return alert("Por favor, introduce un email válido.");
            }

            // Inicia o processo de envio do link
            firebase.auth().sendSignInLinkToEmail(email, actionCodeSettings)
                .then(() => {
                    // Salva o e-mail localmente para confirmar na volta
                    window.localStorage.setItem('emailForSignIn', email);
                    alert('¡Enlace enviado! Revisa tu bandeja de entrada en unos instantes.');
                })
                .catch((error) => {
                    console.error("Error Firebase:", error);
                    alert('Hubo un error: ' + error.message);
                });
        }

        // Lógica para completar o login quando o usuário volta do e-mail
        if (firebase.auth().isSignInWithEmailLink(window.location.href)) {
            let email = window.localStorage.getItem('emailForSignIn');
            if (!email) {
                email = window.prompt('Por favor, confirma tu email para iniciar sesión:');
            }
            firebase.auth().signInWithEmailLink(email, window.location.href)
                .then((result) => {
                    window.localStorage.removeItem('emailForSignIn');
                    alert('¡Bienvenido! Has iniciado sesión correctamente.');
                    // Aqui você pode redirecionar para o Dashboard futuramente
                })
                .catch((error) => {
                    alert('Error al completar el ingreso: ' + error.message);
                });
        }
    </script>
</body>
</html>